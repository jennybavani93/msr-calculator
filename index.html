<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>MSR POS v3.0</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
const firebaseConfig = {
 // Import the functions you need from the SDKs you need
import { initializeApp } from "firebase/app";
// TODO: Add SDKs for Firebase products that you want to use
// https://firebase.google.com/docs/web/setup#available-libraries

// Your web app's Firebase configuration
const firebaseConfig = {
  apiKey: "AIzaSyB8PgmBscFjmyPEursRcEK2Nfw-ulPWY6A",
  authDomain: "msr-pos.firebaseapp.com",
  databaseURL: "https://msr-pos-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "msr-pos",
  storageBucket: "msr-pos.firebasestorage.app",
  messagingSenderId: "984323905404",
  appId: "1:984323905404:web:92974e34cd90c35e3df6f9"
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);
};

firebase.initializeApp(firebaseConfig);

const db = firebase.database();
const menuRef = db.ref("menuData");
const salesRef = db.ref("sales");
const dayTotalRef = db.ref("dayTotal");

</script>
  
<style>
body{font-family:Arial;background:#111;color:#fff;margin:0;padding:8px}
h1{text-align:center;color:#f5c542;font-size:20px;margin:6px 0}
h2{font-size:15px;margin:12px 0 4px;border-bottom:1px solid #444}

.box{background:#1b1b1b;padding:6px;border-radius:6px;margin-bottom:8px;font-size:12px}
.total{background:#000;text-align:center;font-size:20px}

.menu{display:grid;grid-template-columns:repeat(3,1fr);gap:6px}

.item{display:flex;border-radius:6px;overflow:hidden}
.item-btn{flex:1;padding:6px 4px;font-size:12px;border:none;cursor:pointer}
.plus,.minus{width:22px;border:none;background:#333;color:#fff;font-size:14px}

.food{background:#f5c542;color:#000}
.drink{background:#03a9f4;color:#000}
.addon{background:#8bc34a;color:#000}

.selected{outline:2px solid #fff}

.row{display:flex;justify-content:space-between;align-items:center;margin-bottom:6px}

input{border:none;border-radius:4px;padding:4px;text-align:right}

button{border:none;border-radius:4px;padding:6px 8px;cursor:pointer}

.tabbar button{margin:2px;font-size:12px}
.active{background:#4caf50;color:#000}

.action{width:100%;background:#4caf50;color:#000;font-size:14px;margin-bottom:6px}
.action:disabled{opacity:.4}

.danger{width:100%;background:#e53935;color:#fff;font-size:14px}

.order-item{display:flex;justify-content:space-between;gap:6px;margin-bottom:4px}
.order-item button{padding:2px 6px;font-size:12px}

.small{font-size:11px}
</style>
</head>

<body>

<h1>Mona's Spice Route POS v3.0</h1>

<div class="box tabbar" id="tabs"></div>

<button class="action" onclick="toggleEditMenu()">⚙ Edit Menu</button>

<div class="box total">
<span id="tabName"></span> Total : RM <span id="total">0.00</span>
</div>

<div class="box" id="orderList"><em>No items yet</em></div>

<div class="box">
<div class="row">
<span>Other item (RM)</span>
<input id="otherAmount" type="number">
<button onclick="addOther()">Add</button>
</div>
</div>

<div class="box">
<div class="row">
<span>Cash Given (RM)</span>
<input id="cash" type="number" oninput="onCash()">
</div>
<div class="row">
<b>Balance</b>
<b>RM <span id="balance">0.00</span></b>
</div>
</div>

<button id="completeBtn" class="action" onclick="completeSale()" disabled>
Complete Sale
</button>

<h2>All Day Menu</h2>
<div class="menu" id="menu-All Day Menu"></div>

<h2>Evening Tiffin</h2>
<div class="menu" id="menu-Evening Tiffin"></div>

<h2>Drinks</h2>
<div class="menu" id="menu-Drinks"></div>

<h2>Take Away / Add Ons</h2>
<div class="menu" id="menu-Take Away / Add Ons"></div>

<div class="box">
<div class="row">
<span>End of Day Total</span>
<b>RM <span id="dayTotal">0.00</span></b>
</div>
<button class="danger" onclick="resetDay()">Reset Day</button>
</div>

<script>
/* ---------------- PIN ---------------- */

const EDIT_PIN = "1234";
let editMode = false;

/* ---------------- MENU DATA ---------------- */

let menuData = JSON.parse(localStorage.getItem("menuData")) || {

"All Day Menu": [
  { name:"Nasi Lemak Kosong", label:"NL Kosong", price:2.8, type:"food" },
  { name:"Nasi Lemak Vege", label:"NL Vege", price:3.8, type:"food" },
  { name:"Nasi Lemak Telur", label:"NL Telur", price:3.8, type:"food" },
  { name:"Mee / Bihun / Kuey", label:"Mee / Bihun / Kuey", price:3.0, type:"food" },
  { name:"Thosai", label:"Thosai", price:1.8, type:"food" },
  { name:"Ghee Thosai", label:"Ghee Thosai", price:2.5, type:"food" },
  { name:"Butter Thosai", label:"Butter Thosai", price:2.5, type:"food" },
  { name:"Egg Thosai", label:"Egg Thosai", price:2.5, type:"food" },
  { name:"Rawa Thosai", label:"Rawa Thosai", price:2.5, type:"food" },
  { name:"Idli", label:"Idli", price:0.7, type:"food" },
  { name:"Puri", label:"Puri", price:2.0, type:"food" },
  { name:"Chapati", label:"Chapati", price:2.0, type:"food" },
  { name:"Roti Canai", label:"Roti Canai", price:1.5, type:"food" },
  { name:"Roti Canai Telur", label:"Roti Canai Egg", price:2.4, type:"food" },
  { name:"Paal Appam", label:"Paal Appam", price:2.5, type:"food" },
  { name:"Karuppu Chini Paal Appam", label:"KC Paal Appam", price:3.0, type:"food" },
  { name:"Paniyaram (4pcs)", label:"Paniyaram", price:2.5, type:"food" },
  { name:"Karipap", label:"Karipap", price:0.6, type:"food" }
],

"Evening Tiffin": [
  { name:"Mee Goreng Biasa", label:"Mee Goreng Biasa", price:7.0, type:"food" },
  { name:"Mee Goreng Vege", label:"Mee Goreng Veg", price:6.0, type:"food" },

  { name:"Bihun Goreng Biasa", label:"Bihun Goreng Biasa", price:7.0, type:"food" },
  { name:"Bihun Goreng Vege", label:"Bihun Goreng Veg", price:6.0, type:"food" },

  { name:"Maggi Goreng Biasa", label:"Maggi Goreng Biasa", price:7.0, type:"food" },
  { name:"Maggi Goreng Vege", label:"Maggi Goreng Veg", price:6.0, type:"food" },

  { name:"Nasi Goreng Biasa", label:"Nasi Goreng Biasa", price:7.5, type:"food" },
  { name:"Nasi Goreng Veg", label:"Nasi Goreng Veg", price:6.5, type:"food" },

  { name:"Nasi Lemak Goreng", label:"NL Goreng", price:6.5, type:"food" }
],

"Drinks": [

  { name:"Teh (Hot)", label:"Teh H", price:2.3, type:"drink" },
  { name:"Teh (Cold)", label:"Teh C", price:3.0, type:"drink" },

  { name:"Teh Halia (Hot)", label:"Teh Halia H", price:3.3, type:"drink" },

  { name:"Teh O (Hot)", label:"Teh O H", price:1.8, type:"drink" },
  { name:"Teh O (Cold)", label:"Teh O C", price:2.3, type:"drink" },

  { name:"Teh O Halia (Hot)", label:"Teh O Halia H", price:2.8, type:"drink" },

  { name:"Teh O Limau (Hot)", label:"Teh O Limau H", price:2.3, type:"drink" },
  { name:"Teh O Limau (Cold)", label:"Teh O Limau C", price:2.8, type:"drink" },

  { name:"Nescafe (Hot)", label:"Nescafe H", price:2.8, type:"drink" },
  { name:"Nescafe (Cold)", label:"Nescafe C", price:3.5, type:"drink" },

  { name:"Nescafe O (Hot)", label:"Nescafe O H", price:2.3, type:"drink" },
  { name:"Nescafe O (Cold)", label:"Nescafe O C", price:3.0, type:"drink" },

  { name:"Kopi (Hot)", label:"Kopi H", price:2.3, type:"drink" },
  { name:"Kopi (Cold)", label:"Kopi C", price:3.0, type:"drink" },

  { name:"Kopi O (Hot)", label:"Kopi O H", price:1.8, type:"drink" },
  { name:"Kopi O (Cold)", label:"Kopi O C", price:2.3, type:"drink" },

  { name:"Milo (Hot)", label:"Milo H", price:2.8, type:"drink" },
  { name:"Milo (Cold)", label:"Milo C", price:3.5, type:"drink" },

  { name:"Bru Coffee (Hot)", label:"Bru H", price:3.3, type:"drink" },
  { name:"Bru Coffee (Cold)", label:"Bru C", price:4.0, type:"drink" },

  { name:"Bru Coffee O (Hot)", label:"Bru O H", price:3.0, type:"drink" },
  { name:"Bru Coffee O (Cold)", label:"Bru O C", price:3.5, type:"drink" },

  { name:"Limau (Hot)", label:"Limau H", price:2.0, type:"drink" },
  { name:"Limau (Cold)", label:"Limau C", price:2.5, type:"drink" },

  { name:"Sirap (Hot)", label:"Sirap H", price:2.0, type:"drink" },
  { name:"Sirap (Cold)", label:"Sirap C", price:2.5, type:"drink" },

  { name:"Sirap Limau (Hot)", label:"Sirap Limau H", price:2.3, type:"drink" },
  { name:"Sirap Limau (Cold)", label:"Sirap Limau C", price:3.0, type:"drink" },

  { name:"Sirap Bandung (Hot)", label:"Bandung H", price:2.8, type:"drink" },
  { name:"Sirap Bandung (Cold)", label:"Bandung C", price:3.5, type:"drink" },

  { name:"Coke", label:"Coke", price:3.0, type:"drink" },
  { name:"100 Plus", label:"100+", price:3.0, type:"drink" },

  { name:"Soya Bean", label:"Soya", price:2.5, type:"drink" },
  { name:"Cincau", label:"Cincau", price:2.5, type:"drink" },

  { name:"Teh Bunga", label:"Teh Bunga", price:2.5, type:"drink" }

],

"Take Away / Add Ons":[
{name:"Add Egg",label:"Add Egg",price:1.0,type:"addon"},
{name:"Take Away Charge",label:"Take Away",price:0.3,type:"addon"}
]

};

function saveMenu(){
localStorage.setItem("menuData",JSON.stringify(menuData));
}

/* ---------------- TABS ---------------- */

const TABLES=6, TAKEAWAYS=3;
let tabs=[],current=0;

function newTab(){return{order:{},total:0,cash:""}}

for(let i=1;i<=TABLES;i++)tabs.push({name:"Table "+i,data:newTab()});
for(let i=1;i<=TAKEAWAYS;i++)tabs.push({name:"Take Away "+i,data:newTab()});

/* ---------------- DAY TOTAL ---------------- */

let dayTotal=parseFloat(localStorage.getItem("dayTotal"))||0;
document.getElementById("dayTotal").innerText=dayTotal.toFixed(2);

/* ---------------- UI ---------------- */

function drawTabs(){
const t=document.getElementById("tabs");t.innerHTML="";
tabs.forEach((x,i)=>{
let b=document.createElement("button");
b.textContent=x.name;
if(i===current)b.classList.add("active");
b.onclick=()=>switchTab(i);
t.appendChild(b);
});
document.getElementById("tabName").innerText=tabs[current].name;
}

function tab(){return tabs[current].data;}

function switchTab(i){
saveCash();
current=i;
drawTabs();
restoreSelections();
updateUI();
restoreCash();
}

drawTabs();

/* ---------------- ORDER ---------------- */

function toggleItem(name,price,btn){
let t=tab();
if(t.order[name]){
t.total-=t.order[name].qty*price;
delete t.order[name];
btn.classList.remove("selected");
}else{
t.order[name]={qty:1,price,label:name};
t.total+=price;
btn.classList.add("selected");
}
updateUI();
}

function addQty(e,name,price){
e.stopPropagation();
let t=tab();
if(!t.order[name])t.order[name]={qty:0,price,label:name};
t.order[name].qty++;
t.total+=price;
mark(name,true);
updateUI();
}

function minusQty(e,name,price){
e.stopPropagation();
let t=tab();
if(!t.order[name])return;
t.order[name].qty--;
t.total-=price;
if(t.order[name].qty<=0){
delete t.order[name];
mark(name,false);
}
updateUI();
}

/* ---------------- OTHER ---------------- */

function addOther(){
let v=parseFloat(otherAmount.value);
if(!(v>0))return;
let id="OTHER-"+Date.now();
let t=tab();
t.order[id]={qty:1,price:v,label:"Other item"};
t.total+=v;
otherAmount.value="";
updateUI();
}

/* ---------------- ORDER LIST ---------------- */

function minusFromList(id){
let t=tab();
if(!t.order[id])return;
t.order[id].qty--;
t.total-=t.order[id].price;
if(t.order[id].qty<=0){
delete t.order[id];
if(!id.startsWith("OTHER-"))mark(id,false);
}
updateUI();
}

function removeFromList(id){
let t=tab();
if(!t.order[id])return;
t.total-=t.order[id].qty*t.order[id].price;
delete t.order[id];
if(!id.startsWith("OTHER-"))mark(id,false);
updateUI();
}

/* ---------------- CASH ---------------- */

function onCash(){
calcBalance();
completeBtn.disabled=!(parseFloat(cash.value)>0);
}

function calcBalance(){
let t=tab();
let c=parseFloat(cash.value)||0;
balance.innerText=(c-t.total).toFixed(2);
}

function saveCash(){tab().cash=cash.value;}
function restoreCash(){cash.value=tab().cash||"";onCash();}

/* ---------------- COMPLETE ---------------- */

function completeSale(){
let t=tab();
let c=parseFloat(cash.value);
if(!(c>0)||t.total<=0)return;

dayTotal+=t.total;
localStorage.setItem("dayTotal",dayTotal);
dayTotalSpan.innerText=dayTotal.toFixed(2);

tabs[current].data=newTab();
restoreSelections();
restoreCash();
updateUI();
}

const dayTotalSpan=document.getElementById("dayTotal");

/* ---------------- RESET DAY ---------------- */

function resetDay(){
if(!confirm("Reset day total?"))return;
dayTotal=0;
localStorage.removeItem("dayTotal");
dayTotalSpan.innerText="0.00";
}

/* ---------------- RENDER ORDER ---------------- */

function updateUI(){
let t=tab();
total.innerText=t.total.toFixed(2);
orderList.innerHTML="";

for(let id in t.order){
let l=t.order[id];
let line=l.qty*l.price;
orderList.innerHTML+=`
<div class="order-item">
<span>${l.label} x${l.qty}</span>
<div>
<button onclick="minusFromList('${id}')">−</button>
<button onclick="removeFromList('${id}')">✕</button>
<span> RM ${line.toFixed(2)}</span>
</div>
</div>`;
}

if(!Object.keys(t.order).length)
orderList.innerHTML="<em>No items yet</em>";

calcBalance();
}

/* ---------------- MENU RENDER ---------------- */

function renderMenus(){

for(let section in menuData){

let box=document.getElementById("menu-"+section);
box.innerHTML="";

menuData[section].forEach((m,idx)=>{

box.innerHTML+=`
<div class="item">
<button class="item-btn ${m.type}" data-name="${m.name}"
onclick="toggleItem('${m.name}',${m.price},this)">
${m.label}<br>RM ${m.price.toFixed(2)}
</button>
<button class="minus" onclick="minusQty(event,'${m.name}',${m.price})">−</button>
<button class="plus" onclick="addQty(event,'${m.name}',${m.price})">+</button>
</div>
`;

if(editMode){
box.innerHTML+=`
<div class="small" style="grid-column:span 3">
Price:
<input type="number" value="${m.price}"
onchange="editPrice('${section}',${idx},this.value)">
<button onclick="deleteItem('${section}',${idx})">Delete</button>
</div>`;
}

});

if(editMode){
box.innerHTML+=`
<div style="grid-column:span 3" class="small">
<input id="n1-${section}" placeholder="Name">
<input id="n2-${section}" placeholder="Label">
<input id="n3-${section}" type="number" placeholder="Price">
<button onclick="addItem('${section}')">Add</button>
</div>`;
}

}

restoreSelections();
}

/* ---------------- MENU EDIT ---------------- */

function toggleEditMenu(){

if(!editMode){
let p=prompt("Enter PIN");
if(p!==EDIT_PIN)return alert("Wrong PIN");
}

editMode=!editMode;
renderMenus();
}

function editPrice(section,idx,val){
menuData[section][idx].price=parseFloat(val)||0;
saveMenu();
renderMenus();
}

function deleteItem(section,idx){
if(!confirm("Delete item?"))return;
menuData[section].splice(idx,1);
saveMenu();
renderMenus();
}

function addItem(section){
let n=document.getElementById("n1-"+section).value;
let l=document.getElementById("n2-"+section).value;
let p=parseFloat(document.getElementById("n3-"+section).value);
if(!n||!l||!(p>0))return;

menuData[section].push({
name:n,label:l,price:p,
type:section==="Drinks"?"drink":section==="Take Away / Add Ons"?"addon":"food"
});
saveMenu();
renderMenus();
}

/* ---------------- SELECTION ---------------- */

function mark(name,on){
document.querySelectorAll('.item-btn[data-name="'+name+'"]')
.forEach(b=>on?b.classList.add("selected"):b.classList.remove("selected"));
}

function restoreSelections(){
document.querySelectorAll(".item-btn").forEach(b=>b.classList.remove("selected"));
let t=tab();
for(let id in t.order){
if(!id.startsWith("OTHER-"))mark(id,true);
}
}

/* ---------------- INIT ---------------- */

renderMenus();
restoreSelections();
updateUI();
restoreCash();
</script>

<script>
if("serviceWorker" in navigator){
window.addEventListener("load",()=>{navigator.serviceWorker.register("./sw.js");});
}
</script>

</body>
</html>

